<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lewis Dot Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom animations for confetti */
        @keyframes bounce-custom {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes pulse-custom {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.1);
            }
        }

        .animate-bounce-custom {
            animation: bounce-custom 1s infinite;
        }

        .animate-pulse-custom {
            animation: pulse-custom 2s infinite;
        }

        /* Transition utility */
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>

<body
    class="min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-blue-100 p-4 md:p-8 flex flex-col items-center">

    <!-- Header -->
    <header class="w-full max-w-4xl flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg text-white">
                <i data-lucide="flask-conical" class="w-6 h-6"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-slate-900">Lewis Dot Builder</h1>
                <p class="text-sm text-slate-500">Practice valence electrons & structures</p>
            </div>
        </div>

        <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-slate-200">
            <span class="text-sm font-medium text-slate-600">Progress:</span>
            <div id="progress-dots" class="flex gap-1">
                <!-- Progress dots generated by JS -->
            </div>
        </div>
    </header>

    <!-- Main Game Card -->
    <main
        class="w-full max-w-2xl bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 flex flex-col relative min-h-[500px]">

        <!-- GAME VIEW CONTAINER -->
        <div id="game-view" class="flex flex-col h-full w-full">
            <!-- Info Bar -->
            <div class="bg-slate-50 border-b border-slate-100 p-4 flex justify-between items-center">
                <div class="flex flex-col">
                    <span id="element-info" class="text-xs font-bold text-blue-600 uppercase tracking-wider">Group
                        Info</span>
                    <span id="element-name" class="text-lg font-semibold">Element Name</span>
                </div>
                <div class="text-right">
                    <span class="text-xs text-slate-400 block">Atomic Number</span>
                    <span id="atomic-number" class="font-mono font-bold text-slate-600">0</span>
                </div>
            </div>

            <!-- Interaction Area -->
            <div class="flex-1 p-8 md:p-12 flex flex-col items-center justify-center relative min-h-[400px]">

                <!-- Instructions Overlay (Visible when empty) -->
                <div id="instruction-overlay"
                    class="absolute top-4 text-slate-400 text-sm flex items-center gap-2 animate-pulse transition-opacity duration-300">
                    <i data-lucide="info" class="w-4 h-4"></i>
                    Click the dashed boxes to add electrons
                </div>

                <!-- The Atom Grid -->
                <div class="relative w-64 h-64 grid grid-cols-3 grid-rows-3 gap-2">

                    <!-- TOP ZONE -->
                    <div class="col-start-2 row-start-1 flex justify-center items-end pb-2">
                        <button onclick="handleZoneClick('top')" id="btn-top"
                            class="w-16 h-16 rounded-xl border-2 border-dashed border-slate-200 hover:border-blue-300 hover:bg-slate-50 flex items-center justify-center transition-all duration-200 active:scale-95">
                            <!-- Dots injected here -->
                        </button>
                    </div>

                    <!-- LEFT ZONE -->
                    <div class="col-start-1 row-start-2 flex justify-end items-center pr-2">
                        <button onclick="handleZoneClick('left')" id="btn-left"
                            class="w-16 h-16 rounded-xl border-2 border-dashed border-slate-200 hover:border-blue-300 hover:bg-slate-50 flex items-center justify-center transition-all duration-200 active:scale-95">
                            <!-- Dots injected here -->
                        </button>
                    </div>

                    <!-- CENTER: SYMBOL -->
                    <div id="atom-symbol"
                        class="col-start-2 row-start-2 flex items-center justify-center bg-slate-900 rounded-2xl shadow-inner text-white font-bold text-4xl md:text-5xl select-none z-10 relative overflow-hidden">
                        H
                        <!-- Glossy effect -->
                        <div class="absolute top-0 left-0 w-full h-1/2 bg-white opacity-10 pointer-events-none"></div>
                    </div>

                    <!-- RIGHT ZONE -->
                    <div class="col-start-3 row-start-2 flex justify-start items-center pl-2">
                        <button onclick="handleZoneClick('right')" id="btn-right"
                            class="w-16 h-16 rounded-xl border-2 border-dashed border-slate-200 hover:border-blue-300 hover:bg-slate-50 flex items-center justify-center transition-all duration-200 active:scale-95">
                            <!-- Dots injected here -->
                        </button>
                    </div>

                    <!-- BOTTOM ZONE -->
                    <div class="col-start-2 row-start-3 flex justify-center items-start pt-2">
                        <button onclick="handleZoneClick('bottom')" id="btn-bottom"
                            class="w-16 h-16 rounded-xl border-2 border-dashed border-slate-200 hover:border-blue-300 hover:bg-slate-50 flex items-center justify-center transition-all duration-200 active:scale-95">
                            <!-- Dots injected here -->
                        </button>
                    </div>

                </div>

                <!-- Valence Counter -->
                <div class="absolute bottom-4 right-4 text-xs font-mono text-slate-300">
                    Current Dots: <span id="dot-counter">0</span>
                </div>
            </div>

            <!-- Feedback Area -->
            <div id="feedback-area"
                class="p-6 min-h-[100px] flex items-center justify-center transition-colors duration-300 bg-white">
                <div id="feedback-content" class="text-center w-full">
                    <p class="text-slate-400 text-sm italic">Place electrons according to the element's group number.
                    </p>
                </div>
            </div>

            <!-- Control Bar -->
            <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center gap-4">
                <button onclick="resetCurrent()"
                    class="p-2 text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-lg transition-colors"
                    title="Reset Dots">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>

                <!-- Dynamic Action Button -->
                <div id="action-btn-container" class="flex-1">
                    <button onclick="checkAnswer()"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-blue-200 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5 active:translate-y-0">
                        Check Answer
                    </button>
                </div>
            </div>
        </div>

        <!-- FINAL SUCCESS VIEW (Hidden by default) -->
        <div id="final-view"
            class="hidden flex-col items-center justify-center p-12 text-center h-full w-full bg-gradient-to-b from-white to-blue-50 absolute inset-0 z-20">
            <div
                class="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mb-6 text-yellow-600 shadow-inner">
                <i data-lucide="trophy" class="w-12 h-12"></i>
            </div>
            <h2 class="text-3xl font-bold text-slate-900 mb-2">Congratulations!</h2>
            <p class="text-slate-600 mb-8 max-w-md text-lg">You've successfully mastered the Lewis Dot structures for
                all 18 elements. You are a chemistry superstar!</p>

            <button onclick="restartGame()"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-xl shadow-xl shadow-blue-200 flex items-center gap-2 transition-all transform hover:-translate-y-1 hover:scale-105 active:scale-95">
                <i data-lucide="rotate-ccw" class="w-5 h-5"></i> Play Again
            </button>
        </div>

        <!-- Confetti Container -->
        <div id="confetti-container"
            class="absolute inset-0 pointer-events-none z-50 overflow-hidden hidden justify-center">
            <div class="absolute top-1/4 animate-bounce-custom text-4xl">ðŸŽ‰</div>
            <div class="absolute top-1/3 left-1/4 animate-pulse-custom text-4xl" style="animation-delay: 0.1s">âœ¨</div>
            <div class="absolute top-1/3 right-1/4 animate-pulse-custom text-4xl" style="animation-delay: 0.2s">ðŸŒŸ</div>
            <div class="absolute top-1/2 left-1/2 animate-bounce-custom text-4xl" style="animation-delay: 0.3s">ðŸ§ª</div>
        </div>

    </main>

    <!-- Instructions Footer -->
    <div class="mt-12 max-w-2xl text-slate-500 text-sm space-y-2 text-center md:text-left">
        <h3 class="font-bold text-slate-700 flex items-center justify-center md:justify-start gap-2">
            <i data-lucide="trophy" class="w-4 h-4"></i> How to play
        </h3>
        <ul class="list-disc pl-5 space-y-1 marker:text-blue-400 inline-block text-left md:inline">
            <li>Determine the number of valence electrons based on the Group number.</li>
            <li>Click the boxes around the element symbol to add electrons.</li>
            <li><strong>Hund's Rule:</strong> For most elements, place one electron on each side before pairing them up!
            </li>
            <li><strong>Exception:</strong> Helium has a full valence shell with just 2 electrons, so keep them
                together.</li>
        </ul>
    </div>

    <script>
        // Element Data
        const ELEMENTS = [
            { symbol: 'H', name: 'Hydrogen', atomicNumber: 1, valence: 1, group: 1, info: 'Group 1: Alkali Metals' },
            { symbol: 'He', name: 'Helium', atomicNumber: 2, valence: 2, group: 18, info: 'Group 18: Noble Gases' },
            { symbol: 'Li', name: 'Lithium', atomicNumber: 3, valence: 1, group: 1, info: 'Group 1: Alkali Metals' },
            { symbol: 'Be', name: 'Beryllium', atomicNumber: 4, valence: 2, group: 2, info: 'Group 2: Alkaline Earth' },
            { symbol: 'B', name: 'Boron', atomicNumber: 5, valence: 3, group: 13, info: 'Group 13' },
            { symbol: 'C', name: 'Carbon', atomicNumber: 6, valence: 4, group: 14, info: 'Group 14' },
            { symbol: 'N', name: 'Nitrogen', atomicNumber: 7, valence: 5, group: 15, info: 'Group 15: Pnictogens' },
            { symbol: 'O', name: 'Oxygen', atomicNumber: 8, valence: 6, group: 16, info: 'Group 16: Chalcogens' },
            { symbol: 'F', name: 'Fluorine', atomicNumber: 9, valence: 7, group: 17, info: 'Group 17: Halogens' },
            { symbol: 'Ne', name: 'Neon', atomicNumber: 10, valence: 8, group: 18, info: 'Group 18: Noble Gases' },
            { symbol: 'Na', name: 'Sodium', atomicNumber: 11, valence: 1, group: 1, info: 'Group 1: Alkali Metals' },
            { symbol: 'Mg', name: 'Magnesium', atomicNumber: 12, valence: 2, group: 2, info: 'Group 2: Alkaline Earth' },
            { symbol: 'Al', name: 'Aluminium', atomicNumber: 13, valence: 3, group: 13, info: 'Group 13' },
            { symbol: 'Si', name: 'Silicon', atomicNumber: 14, valence: 4, group: 14, info: 'Group 14' },
            { symbol: 'P', name: 'Phosphorus', atomicNumber: 15, valence: 5, group: 15, info: 'Group 15' },
            { symbol: 'S', name: 'Sulfur', atomicNumber: 16, valence: 6, group: 16, info: 'Group 16' },
            { symbol: 'Cl', name: 'Chlorine', atomicNumber: 17, valence: 7, group: 17, info: 'Group 17' },
            { symbol: 'Ar', name: 'Argon', atomicNumber: 18, valence: 8, group: 18, info: 'Group 18' },
        ];

        // State
        let currentIndex = 0;
        let dots = { top: 0, right: 0, bottom: 0, left: 0 };
        let feedback = null; // null, 'correct', 'incorrect'
        let message = '';
        let isGameComplete = false;

        // Initial Render
        window.onload = function () {
            lucide.createIcons();
            renderApp();
        };

        // --- Logic ---

        function handleZoneClick(zone) {
            if (feedback === 'correct') return; // Lock if correct

            // Cycle 0 -> 1 -> 2 -> 0
            dots[zone] = dots[zone] >= 2 ? 0 : dots[zone] + 1;

            // Clear error if present
            if (feedback === 'incorrect') {
                feedback = null;
                message = '';
            }

            renderGameArea();
            renderFeedback();
        }

        function checkAnswer() {
            const currentElement = ELEMENTS[currentIndex];
            const totalPlaced = Object.values(dots).reduce((a, b) => a + b, 0);
            const sidesWithDots = Object.values(dots).filter(d => d > 0).length;
            const sidesWithPairs = Object.values(dots).filter(d => d === 2).length;

            // 1. Check Total
            if (totalPlaced !== currentElement.valence) {
                feedback = 'incorrect';
                message = `Incorrect number of electrons. ${currentElement.name} is in Group ${currentElement.group > 10 ? currentElement.group - 10 : currentElement.group}A, so it has ${currentElement.valence} valence electrons. You placed ${totalPlaced}.`;
                renderFeedback();
                return;
            }

            // 2. Helium Exception
            if (currentElement.symbol === 'He') {
                if (sidesWithPairs === 1 && sidesWithDots === 1) {
                    handleSuccess();
                } else {
                    feedback = 'incorrect';
                    message = "Close! Helium is a special case. Its valence shell (1s) can only hold 2 electrons, and it is full. We usually draw them as a pair on one side.";
                    renderFeedback();
                }
                return;
            }

            // 3. Hund's Rule (Singles before pairs)
            let isValidDistribution = true;
            if (currentElement.valence <= 4) {
                if (sidesWithPairs > 0) {
                    isValidDistribution = false;
                    message = "Remember Hund's rule: Place one electron on each side before pairing them up!";
                }
            } else {
                const expectedPairs = currentElement.valence - 4;
                if (sidesWithPairs !== expectedPairs) {
                    isValidDistribution = false;
                    message = "Remember Hund's rule: Fill all four sides with one electron first, then start pairing them up.";
                }
            }

            if (isValidDistribution) {
                handleSuccess();
            } else {
                feedback = 'incorrect';
                renderFeedback();
            }
        }

        function handleSuccess() {
            feedback = 'correct';
            message = "Correct! Well done.";
            renderFeedback();

            // Show confetti
            const confetti = document.getElementById('confetti-container');
            confetti.classList.remove('hidden');
            confetti.classList.add('flex');
        }

        function nextElement() {
            if (currentIndex < ELEMENTS.length - 1) {
                // Next element
                currentIndex++;
                resetState();
            } else {
                // Game Finished
                isGameComplete = true;
                renderApp();
                // Trigger celebratory confetti for the final screen
                const confetti = document.getElementById('confetti-container');
                confetti.classList.remove('hidden');
                confetti.classList.add('flex');
            }
        }

        function restartGame() {
            currentIndex = 0;
            isGameComplete = false;
            resetState();
        }

        function resetCurrent() {
            resetState(false);
        }

        function resetState(changeElement = true) {
            dots = { top: 0, right: 0, bottom: 0, left: 0 };
            feedback = null;
            message = '';

            const confetti = document.getElementById('confetti-container');
            confetti.classList.add('hidden');
            confetti.classList.remove('flex');

            renderApp();
        }

        // --- Rendering ---

        function renderApp() {
            const gameView = document.getElementById('game-view');
            const finalView = document.getElementById('final-view');

            if (isGameComplete) {
                // Show Final Screen
                gameView.classList.add('hidden');
                finalView.classList.remove('hidden');
                finalView.classList.add('flex');
            } else {
                // Show Game
                gameView.classList.remove('hidden');
                finalView.classList.add('hidden');
                finalView.classList.remove('flex');

                renderHeader();
                renderInfoBar();
                renderGameArea();
                renderFeedback();
            }
            // Re-initialize icons in case views switched
            lucide.createIcons();
        }

        function renderHeader() {
            const container = document.getElementById('progress-dots');
            container.innerHTML = ELEMENTS.map((el, idx) => {
                let colorClass = 'bg-slate-200';
                if (idx === currentIndex) colorClass = 'bg-blue-600 scale-125';
                else if (idx < currentIndex) colorClass = 'bg-green-400';

                return `<div class="w-2 h-2 rounded-full transition-colors ${colorClass}"></div>`;
            }).join('');
        }

        function renderInfoBar() {
            const el = ELEMENTS[currentIndex];
            document.getElementById('element-info').textContent = el.info;
            document.getElementById('element-name').textContent = `${el.name} (${el.symbol})`;
            document.getElementById('atomic-number').textContent = el.atomicNumber;
            document.getElementById('atom-symbol').innerHTML = `
                ${el.symbol}
                <div class="absolute top-0 left-0 w-full h-1/2 bg-white opacity-10 pointer-events-none"></div>
            `;
        }

        function renderGameArea() {
            const totalDots = Object.values(dots).reduce((a, b) => a + b, 0);
            document.getElementById('dot-counter').textContent = totalDots;

            // Toggle Instruction Overlay
            const overlay = document.getElementById('instruction-overlay');
            if (totalDots === 0 && !feedback) {
                overlay.classList.remove('opacity-0');
            } else {
                overlay.classList.add('opacity-0');
            }

            // Render Zones
            updateZoneButton('btn-top', dots.top, false);
            updateZoneButton('btn-bottom', dots.bottom, false);
            updateZoneButton('btn-left', dots.left, true);
            updateZoneButton('btn-right', dots.right, true);
        }

        function updateZoneButton(id, count, isVertical) {
            const btn = document.getElementById(id);
            const isActive = count > 0;

            // Base classes
            let cls = "w-16 h-16 rounded-xl border-2 flex items-center justify-center transition-all duration-200 active:scale-95 ";

            // State classes
            if (isActive) {
                cls += "border-transparent bg-blue-50";
            } else {
                cls += "border-dashed border-slate-200 hover:border-blue-300 hover:bg-slate-50";
            }

            // Correct state lock cursor
            if (feedback === 'correct') {
                cls = cls.replace('active:scale-95', 'cursor-default');
            }

            btn.className = cls;
            btn.innerHTML = generateDotHTML(count, isVertical);
        }

        function generateDotHTML(count, isVertical) {
            if (count === 0) return '';

            const dotClass = "w-3 h-3 md:w-4 md:h-4 bg-blue-600 rounded-full shadow-sm";

            if (count === 1) {
                return `<div class="${dotClass}"></div>`;
            }

            const flexDir = isVertical ? 'flex-col' : 'flex-row';
            return `
                <div class="flex gap-1 md:gap-2 ${flexDir}">
                    <div class="${dotClass}"></div>
                    <div class="${dotClass}"></div>
                </div>
            `;
        }

        function renderFeedback() {
            const area = document.getElementById('feedback-area');
            const content = document.getElementById('feedback-content');
            const actionContainer = document.getElementById('action-btn-container');

            // 1. Color State
            area.className = "p-6 min-h-[100px] flex items-center justify-center transition-colors duration-300 ";
            if (feedback === 'correct') area.classList.add('bg-green-50');
            else if (feedback === 'incorrect') area.classList.add('bg-red-50');
            else area.classList.add('bg-white');

            // 2. Content State
            if (!feedback && !message) {
                content.innerHTML = `<p class="text-slate-400 text-sm italic">Place electrons according to the element's group number.</p>`;
            } else {
                const isCorrect = feedback === 'correct';
                const textColor = isCorrect ? 'text-green-800' : 'text-red-800';
                const bgIcon = isCorrect ? 'bg-green-200' : 'bg-red-200';
                const iconName = isCorrect ? 'check' : 'x';
                const title = isCorrect ? 'Great Job!' : 'Keep Trying';

                content.innerHTML = `
                    <div class="flex items-start gap-3 max-w-lg ${textColor} text-left mx-auto">
                        <div class="mt-1 p-1 rounded-full ${bgIcon}">
                            <i data-lucide="${iconName}" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <p class="font-medium">${title}</p>
                            <p class="text-sm opacity-90 leading-relaxed">${message}</p>
                        </div>
                    </div>
                `;
            }

            // 3. Action Button State
            if (feedback === 'correct') {
                const isLastElement = currentIndex === ELEMENTS.length - 1;
                const buttonText = isLastElement ? "Finish Game" : "Next Element";
                const buttonIcon = isLastElement ? "trophy" : "arrow-right";
                const buttonColor = isLastElement ? "bg-amber-500 hover:bg-amber-600 shadow-amber-200" : "bg-green-600 hover:bg-green-700 shadow-green-200";

                actionContainer.innerHTML = `
                    <button onclick="nextElement()" class="w-full ${buttonColor} text-white font-bold py-3 px-6 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5 active:translate-y-0">
                        ${buttonText} <i data-lucide="${buttonIcon}" class="w-5 h-5"></i>
                    </button>
                `;
            } else {
                actionContainer.innerHTML = `
                    <button onclick="checkAnswer()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-blue-200 flex items-center justify-center gap-2 transition-all transform hover:-translate-y-0.5 active:translate-y-0">
                        Check Answer
                    </button>
                `;
            }
            lucide.createIcons();
        }
    </script>
</body>

</html>
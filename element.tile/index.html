<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periodic Tile Generator & Practice</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --tile-border: #222;
            --accent: #007bff;
            --success: #28a745;
            --error: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Mode Toggle Tabs --- */
        .mode-tabs {
            display: flex;
            background: #fff;
            padding: 5px;
            border-radius: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .tab-btn {
            padding: 10px 25px;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background-color: var(--accent);
            color: white;
            box-shadow: 0 2px 5px rgba(0,123,255,0.3);
        }

        /* --- The Tile --- */
        .tile-container {
            width: 260px;
            height: 340px;
            background-color: #ffffff; 
            border: 5px solid var(--tile-border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            box-shadow: 12px 12px 0px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            transition: background-color 0.4s ease;
            position: relative; 
            box-sizing: border-box;
            cursor: pointer; 
        }

        .tile-container:focus {
            outline: none;
            border-color: #000;
        }

        .ion-charge {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            font-weight: 900;
            color: #333;
        }

        .atomic-number {
            align-self: flex-start;
            font-size: 2.2rem;
            font-weight: 900;
            color: #333;
            line-height: 1;
        }

        .symbol {
            font-size: 6.5rem;
            font-weight: 900;
            color: #000;
            margin: -5px 0;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.4);
        }

        .element-name {
            font-size: 1.5rem;
            color: #222;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .atomic-mass {
            font-size: 2.2rem;
            font-weight: 900;
            width: 100%;
            text-align: center;
            border-top: 4px solid var(--tile-border);
            padding-top: 5px;
            color: #111;
        }

        .group-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #444;
            font-weight: bold;
            margin-top: 10px;
        }

        /* --- Controls Container --- */
        .controls-wrapper {
            background: white;
            padding: 25px 35px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
            min-height: 200px; /* Prevent jump when switching modes */
        }

        /* --- Generator Controls --- */
        .input-row {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        label {
            font-size: 0.85rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        input, select {
            padding: 10px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
        }

        input { width: 80px; text-align: center; }
        select { width: 130px; }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            width: 100%;
        }

        button {
            padding: 12px 20px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, filter 0.2s;
            flex: 1;
        }

        button:active { transform: scale(0.98); }
        .btn-generate { background-color: #333; }
        .btn-generate:hover { background-color: #000; }
        .btn-download { background-color: #28a745; }
        .btn-download:hover { filter: brightness(1.1); }
        .btn-check { background-color: var(--accent); }
        .btn-check:hover { filter: brightness(1.1); }
        .btn-solution { background-color: #6c757d; font-size: 0.9rem;} 

        .error-msg {
            color: #d9534f;
            margin-top: 15px;
            min-height: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* --- Practice Mode Styles --- */
        .practice-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .practice-input-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .practice-input-wrap input {
            width: 100%;
            border: 2px solid #ddd;
            font-weight: bold;
            color: #333;
        }

        /* Validation Colors */
        .correct {
            border-color: var(--success) !important;
            background-color: #d4edda;
            color: var(--success) !important;
        }
        .incorrect {
            border-color: var(--error) !important;
            background-color: #f8d7da;
            color: var(--error) !important;
        }

        .hidden-mode {
            display: none;
        }
    </style>
</head>
<body>

    <!-- Mode Tabs -->
    <div class="mode-tabs">
        <button class="tab-btn active" id="tab-gen" onclick="switchMode('generator')">Generator</button>
        <button class="tab-btn" id="tab-prac" onclick="switchMode('practice')">Practice Mode</button>
    </div>

    <!-- The Tile -->
    <figure class="tile-container" id="elementTile" tabindex="0" role="button" aria-label="Periodic Element Tile">
        <div class="ion-charge" id="disp-charge"></div>
        <div class="atomic-number" id="disp-number">1</div>
        <div class="symbol" id="disp-symbol">H</div>
        <div class="element-name" id="disp-name">Hydrogen</div>
        <div style="width:100%; text-align:center;">
             <div class="atomic-mass" id="disp-mass">1</div>
             <div class="group-label" id="disp-group">Nonmetal</div>
        </div>
    </figure>

    <div class="controls-wrapper">
        
        <!-- Generator Controls -->
        <div id="generator-controls">
            <div class="input-row">
                <div class="input-group">
                    <label for="numInput">Atomic #</label>
                    <input type="number" id="numInput" min="1" max="118" value="1">
                </div>
                
                <div class="input-group">
                    <label for="isotopeSelect">Isotope</label>
                    <select id="isotopeSelect" onchange="updateTile()">
                        <option value="standard">Standard</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ionSelect">Ion Charge</label>
                    <select id="ionSelect" onchange="updateTile()">
                        <option value="0">Neutral</option>
                    </select>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn-generate" onclick="findElement()">Find Element</button>
                <button class="btn-download" onclick="downloadTile()">Download PNG</button>
            </div>
            <div class="error-msg" id="errorMsg"></div>
        </div>

        <!-- Practice Controls -->
        <div id="practice-controls" class="hidden-mode">
            <p style="margin-top:0; color:#666; font-size:0.9rem; margin-bottom:15px;">
                Calculate the subatomic particles based on the tile above.
            </p>
            
            <div class="practice-grid">
                <div class="practice-input-wrap">
                    <label>Z</label>
                    <input type="number" id="prac-z" placeholder="?">
                </div>
                <div class="practice-input-wrap">
                    <label>A</label>
                    <input type="number" id="prac-a" placeholder="?">
                </div>
                <div class="practice-input-wrap">
                    <label>Proton</label>
                    <input type="number" id="prac-p" placeholder="?">
                </div>
                <div class="practice-input-wrap">
                    <label>Neutron</label>
                    <input type="number" id="prac-n" placeholder="?">
                </div>
                <div class="practice-input-wrap">
                    <label>Electron</label>
                    <input type="number" id="prac-e" placeholder="?">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-generate" onclick="generatePracticeQuestion()">New Question</button>
                <button class="btn-check" onclick="checkPracticeAnswer()">Check Answer</button>
                <button class="btn-solution" onclick="showSolution()">Solution</button>
            </div>
            <div class="error-msg" id="practiceMsg"></div>
        </div>

    </div>

    <script>
        // Full Data for 1-118 Elements
        const periodicTable = [
            {n:1, s:"H", name:"Hydrogen", m:1.008, iso:[1, 2], ions:[1, -1]},
            {n:2, s:"He", name:"Helium", m:4.0026, iso:[3, 4], ions:[]},
            {n:3, s:"Li", name:"Lithium", m:6.94, iso:[6, 7], ions:[1]},
            {n:4, s:"Be", name:"Beryllium", m:9.0122, iso:[9], ions:[2]},
            {n:5, s:"B", name:"Boron", m:10.81, iso:[10, 11], ions:[3]},
            {n:6, s:"C", name:"Carbon", m:12.011, iso:[12, 13, 14], ions:[4, -4, 2]},
            {n:7, s:"N", name:"Nitrogen", m:14.007, iso:[14, 15], ions:[5, 4, 3, 2, -3]},
            {n:8, s:"O", name:"Oxygen", m:15.999, iso:[16, 17, 18], ions:[-2, -1]},
            {n:9, s:"F", name:"Fluorine", m:18.998, iso:[19], ions:[-1]},
            {n:10, s:"Ne", name:"Neon", m:20.180, iso:[20, 21, 22], ions:[]},
            {n:11, s:"Na", name:"Sodium", m:22.990, iso:[23], ions:[1]},
            {n:12, s:"Mg", name:"Magnesium", m:24.305, iso:[24, 25, 26], ions:[2]},
            {n:13, s:"Al", name:"Aluminium", m:26.982, iso:[27], ions:[3]},
            {n:14, s:"Si", name:"Silicon", m:28.085, iso:[28, 29, 30], ions:[4, -4]},
            {n:15, s:"P", name:"Phosphorus", m:30.974, iso:[31], ions:[5, 3, -3]},
            {n:16, s:"S", name:"Sulfur", m:32.06, iso:[32, 33, 34, 36], ions:[6, 4, -2]},
            {n:17, s:"Cl", name:"Chlorine", m:35.45, iso:[35, 37], ions:[7, 5, 3, 1, -1]},
            {n:18, s:"Ar", name:"Argon", m:39.948, iso:[36, 38, 40], ions:[]},
            {n:19, s:"K", name:"Potassium", m:39.098, iso:[39, 41], ions:[1]},
            {n:20, s:"Ca", name:"Calcium", m:40.078, iso:[40, 42, 43, 44, 46, 48], ions:[2]},
            {n:21, s:"Sc", name:"Scandium", m:44.956, iso:[45], ions:[3]},
            {n:22, s:"Ti", name:"Titanium", m:47.867, iso:[46, 47, 48, 49, 50], ions:[4, 3]},
            {n:23, s:"V", name:"Vanadium", m:50.942, iso:[50, 51], ions:[5, 4, 3, 2]},
            {n:24, s:"Cr", name:"Chromium", m:51.996, iso:[50, 52, 53, 54], ions:[6, 3, 2]},
            {n:25, s:"Mn", name:"Manganese", m:54.938, iso:[55], ions:[7, 4, 2]},
            {n:26, s:"Fe", name:"Iron", m:55.845, iso:[54, 56, 57, 58], ions:[3, 2]},
            {n:27, s:"Co", name:"Cobalt", m:58.933, iso:[59], ions:[3, 2]},
            {n:28, s:"Ni", name:"Nickel", m:58.693, iso:[58, 60, 61, 62, 64], ions:[2, 3]},
            {n:29, s:"Cu", name:"Copper", m:63.546, iso:[63, 65], ions:[2, 1]},
            {n:30, s:"Zn", name:"Zinc", m:65.38, iso:[64, 66, 67, 68, 70], ions:[2]},
            {n:31, s:"Ga", name:"Gallium", m:69.723, iso:[69, 71], ions:[3]},
            {n:32, s:"Ge", name:"Germanium", m:72.630, iso:[70, 72, 73, 74, 76], ions:[4, 2]},
            {n:33, s:"As", name:"Arsenic", m:74.922, iso:[75], ions:[5, 3, -3]},
            {n:34, s:"Se", name:"Selenium", m:78.971, iso:[74, 76, 77, 78, 80, 82], ions:[6, 4, -2]},
            {n:35, s:"Br", name:"Bromine", m:79.904, iso:[79, 81], ions:[5, 1, -1]},
            {n:36, s:"Kr", name:"Krypton", m:83.798, iso:[78, 80, 82, 83, 84, 86], ions:[2]},
            {n:37, s:"Rb", name:"Rubidium", m:85.468, iso:[85, 87], ions:[1]},
            {n:38, s:"Sr", name:"Strontium", m:87.62, iso:[84, 86, 87, 88], ions:[2]},
            {n:39, s:"Y", name:"Yttrium", m:88.906, iso:[89], ions:[3]},
            {n:40, s:"Zr", name:"Zirconium", m:91.224, iso:[90, 91, 92, 94, 96], ions:[4]},
            {n:41, s:"Nb", name:"Niobium", m:92.906, iso:[93], ions:[5, 3]},
            {n:42, s:"Mo", name:"Molybdenum", m:95.95, iso:[92, 94, 95, 96, 97, 98, 100], ions:[6, 4]},
            {n:43, s:"Tc", name:"Technetium", m:98, iso:[97, 98, 99], ions:[7, 4]},
            {n:44, s:"Ru", name:"Ruthenium", m:101.07, iso:[96, 98, 99, 100, 101, 102, 104], ions:[8, 4, 3]},
            {n:45, s:"Rh", name:"Rhodium", m:102.91, iso:[103], ions:[3]},
            {n:46, s:"Pd", name:"Palladium", m:106.42, iso:[102, 104, 105, 106, 108, 110], ions:[4, 2]},
            {n:47, s:"Ag", name:"Silver", m:107.87, iso:[107, 109], ions:[1]},
            {n:48, s:"Cd", name:"Cadmium", m:112.41, iso:[106, 108, 110, 111, 112, 113, 114, 116], ions:[2]},
            {n:49, s:"In", name:"Indium", m:114.82, iso:[113, 115], ions:[3]},
            {n:50, s:"Sn", name:"Tin", m:118.71, iso:[112, 114, 115, 116, 117, 118, 119, 120, 122, 124], ions:[4, 2]},
            {n:51, s:"Sb", name:"Antimony", m:121.76, iso:[121, 123], ions:[5, 3, -3]},
            {n:52, s:"Te", name:"Tellurium", m:127.60, iso:[120, 122, 123, 124, 125, 126, 128, 130], ions:[6, 4, -2]},
            {n:53, s:"I", name:"Iodine", m:126.90, iso:[127], ions:[7, 5, 1, -1]},
            {n:54, s:"Xe", name:"Xenon", m:131.29, iso:[124, 126, 128, 129, 130, 131, 132, 134, 136], ions:[8, 6, 4, 2]},
            {n:55, s:"Cs", name:"Cesium", m:132.91, iso:[133], ions:[1]},
            {n:56, s:"Ba", name:"Barium", m:137.33, iso:[130, 132, 134, 135, 136, 137, 138], ions:[2]},
            {n:57, s:"La", name:"Lanthanum", m:138.91, iso:[138, 139], ions:[3]},
            {n:58, s:"Ce", name:"Cerium", m:140.12, iso:[136, 138, 140, 142], ions:[4, 3]},
            {n:59, s:"Pr", name:"Praseodymium", m:140.91, iso:[141], ions:[3]},
            {n:60, s:"Nd", name:"Neodymium", m:144.24, iso:[142, 143, 144, 145, 146, 148, 150], ions:[3]},
            {n:61, s:"Pm", name:"Promethium", m:145, iso:[145, 147], ions:[3]},
            {n:62, s:"Sm", name:"Samarium", m:150.36, iso:[144, 147, 148, 149, 150, 152, 154], ions:[3, 2]},
            {n:63, s:"Eu", name:"Europium", m:151.96, iso:[151, 153], ions:[3, 2]},
            {n:64, s:"Gd", name:"Gadolinium", m:157.25, iso:[152, 154, 155, 156, 157, 158, 160], ions:[3]},
            {n:65, s:"Tb", name:"Terbium", m:158.93, iso:[159], ions:[4, 3]},
            {n:66, s:"Dy", name:"Dysprosium", m:162.50, iso:[156, 158, 160, 161, 162, 163, 164], ions:[3]},
            {n:67, s:"Ho", name:"Holmium", m:164.93, iso:[165], ions:[3]},
            {n:68, s:"Er", name:"Erbium", m:167.26, iso:[162, 164, 166, 167, 168, 170], ions:[3]},
            {n:69, s:"Tm", name:"Thulium", m:168.93, iso:[169], ions:[3]},
            {n:70, s:"Yb", name:"Ytterbium", m:173.05, iso:[168, 170, 171, 172, 173, 174, 176], ions:[3, 2]},
            {n:71, s:"Lu", name:"Lutetium", m:174.97, iso:[175, 176], ions:[3]},
            {n:72, s:"Hf", name:"Hafnium", m:178.49, iso:[174, 176, 177, 178, 179, 180], ions:[4]},
            {n:73, s:"Ta", name:"Tantalum", m:180.95, iso:[180, 181], ions:[5]},
            {n:74, s:"W", name:"Tungsten", m:183.84, iso:[180, 182, 183, 184, 186], ions:[6, 4]},
            {n:75, s:"Re", name:"Rhenium", m:186.21, iso:[185, 187], ions:[7, 4]},
            {n:76, s:"Os", name:"Osmium", m:190.23, iso:[184, 186, 187, 188, 189, 190, 192], ions:[8, 4]},
            {n:77, s:"Ir", name:"Iridium", m:192.22, iso:[191, 193], ions:[4, 3]},
            {n:78, s:"Pt", name:"Platinum", m:195.08, iso:[190, 192, 194, 195, 196, 198], ions:[4, 2]},
            {n:79, s:"Au", name:"Gold", m:196.97, iso:[197], ions:[3, 1]},
            {n:80, s:"Hg", name:"Mercury", m:200.59, iso:[196, 198, 199, 200, 201, 202, 204], ions:[2, 1]},
            {n:81, s:"Tl", name:"Thallium", m:204.38, iso:[203, 205], ions:[3, 1]},
            {n:82, s:"Pb", name:"Lead", m:207.2, iso:[204, 206, 207, 208], ions:[4, 2]},
            {n:83, s:"Bi", name:"Bismuth", m:208.98, iso:[209], ions:[5, 3]},
            {n:84, s:"Po", name:"Polonium", m:209, iso:[209, 210], ions:[4, 2]},
            {n:85, s:"At", name:"Astatine", m:210, iso:[210, 211], ions:[1, -1]},
            {n:86, s:"Rn", name:"Radon", m:222, iso:[211, 220, 222], ions:[]},
            {n:87, s:"Fr", name:"Francium", m:223, iso:[223], ions:[1]},
            {n:88, s:"Ra", name:"Radium", m:226, iso:[223, 224, 226, 228], ions:[2]},
            {n:89, s:"Ac", name:"Actinium", m:227, iso:[225, 226, 227], ions:[3]},
            {n:90, s:"Th", name:"Thorium", m:232.04, iso:[232], ions:[4]},
            {n:91, s:"Pa", name:"Protactinium", m:231.04, iso:[231], ions:[5, 4]},
            {n:92, s:"U", name:"Uranium", m:238.03, iso:[233, 234, 235, 238], ions:[6, 5, 4, 3]},
            {n:93, s:"Np", name:"Neptunium", m:237, iso:[236, 237], ions:[6, 5, 4, 3]},
            {n:94, s:"Pu", name:"Plutonium", m:244, iso:[238, 239, 240, 241, 242, 244], ions:[6, 5, 4, 3]},
            {n:95, s:"Am", name:"Americium", m:243, iso:[241, 243], ions:[6, 5, 4, 3]},
            {n:96, s:"Cm", name:"Curium", m:247, iso:[243, 244, 245, 246, 247, 248], ions:[4, 3]},
            {n:97, s:"Bk", name:"Berkelium", m:247, iso:[247, 249], ions:[4, 3]},
            {n:98, s:"Cf", name:"Californium", m:251, iso:[249, 250, 251, 252], ions:[4, 3]},
            {n:99, s:"Es", name:"Einsteinium", m:252, iso:[252, 253, 254, 255], ions:[3]},
            {n:100, s:"Fm", name:"Fermium", m:257, iso:[252, 253, 255, 257], ions:[3, 2]},
            {n:101, s:"Md", name:"Mendelevium", m:258, iso:[255, 256, 258, 260], ions:[3, 2]},
            {n:102, s:"No", name:"Nobelium", m:259, iso:[255, 259], ions:[3, 2]},
            {n:103, s:"Lr", name:"Lawrencium", m:262, iso:[256, 260, 262, 266], ions:[3]},
            {n:104, s:"Rf", name:"Rutherfordium", m:267, iso:[261, 263, 265, 267], ions:[4]},
            {n:105, s:"Db", name:"Dubnium", m:268, iso:[262, 263, 266, 267, 268], ions:[5]},
            {n:106, s:"Sg", name:"Seaborgium", m:269, iso:[265, 267, 269, 271], ions:[6]},
            {n:107, s:"Bh", name:"Bohrium", m:270, iso:[267, 270, 272, 274], ions:[7]},
            {n:108, s:"Hs", name:"Hassium", m:269, iso:[269, 270, 275, 277], ions:[8]},
            {n:109, s:"Mt", name:"Meitnerium", m:278, iso:[274, 276, 278], ions:[9, 6, 4, 3, 1]},
            {n:110, s:"Ds", name:"Darmstadtium", m:281, iso:[279, 281], ions:[8, 6, 4, 2, 0]},
            {n:111, s:"Rg", name:"Roentgenium", m:281, iso:[279, 280, 281, 282], ions:[5, 3, 1, -1]},
            {n:112, s:"Cn", name:"Copernicium", m:285, iso:[283, 284, 285], ions:[2, 1, 0]},
            {n:113, s:"Nh", name:"Nihonium", m:286, iso:[284, 285, 286], ions:[5, 3, 1]},
            {n:114, s:"Fl", name:"Flerovium", m:289, iso:[287, 288, 289], ions:[6, 4, 2, 1, 0]},
            {n:115, s:"Mc", name:"Moscovium", m:288, iso:[288, 289, 290], ions:[3, 1]},
            {n:116, s:"Lv", name:"Livermorium", m:293, iso:[290, 291, 292, 293], ions:[4, 2]},
            {n:117, s:"Ts", name:"Tennessine", m:294, iso:[293, 294], ions:[5, 3, 1, -1]},
            {n:118, s:"Og", name:"Oganesson", m:294, iso:[294], ions:[8, 6, 4, 2, 0]}
        ];

        let currentElement = null;
        let practiceData = { Z:0, A:0, p:0, n:0, e:0 };
        let mode = 'generator';

        // --- Helpers ---
        function getElementGroup(n) {
             if (n === 1) return { c: "#ffcdd2", g: "Nonmetal" };
             if ([2, 10, 18, 36, 54, 86, 118].includes(n)) return { c: "#e1bee7", g: "Noble Gas" }; 
             if ([3, 11, 19, 37, 55, 87].includes(n)) return { c: "#ffcc80", g: "Alkali Metal" };
             if ([4, 12, 20, 38, 56, 88].includes(n)) return { c: "#fff59d", g: "Alkaline Earth" };
             if (n >= 57 && n <= 71) return { c: "#f48fb1", g: "Lanthanide" };
             if (n >= 89 && n <= 103) return { c: "#ce93d8", g: "Actinide" };
             if ([9, 17, 35, 53, 85, 117].includes(n)) return { c: "#b2dfdb", g: "Halogen" };
             if ((n >= 21 && n <= 30) || (n >= 39 && n <= 48) || (n >= 72 && n <= 80) || (n >= 104 && n <= 112)) 
                 return { c: "#90caf9", g: "Transition Metal" };
             if ([5, 14, 32, 33, 51, 52].includes(n)) return { c: "#a5d6a7", g: "Metalloid" };
             if ([6, 7, 8, 15, 16, 34].includes(n)) return { c: "#ffcdd2", g: "Nonmetal" };
             return { c: "#e0e0e0", g: "Metal" };
        }

        function formatCharge(c) {
            if (c === 0) return "";
            if (c === 1) return "+";   
            if (c === -1) return "âˆ’";  
            const sign = c > 0 ? "+" : "";
            return sign + c;           
        }

        // --- Mode Switching ---
        function switchMode(newMode) {
            mode = newMode;
            document.getElementById('tab-gen').classList.toggle('active', mode === 'generator');
            document.getElementById('tab-prac').classList.toggle('active', mode === 'practice');
            
            if (mode === 'generator') {
                document.getElementById('generator-controls').classList.remove('hidden-mode');
                document.getElementById('practice-controls').classList.add('hidden-mode');
                findElement(); // Restore generator state
            } else {
                document.getElementById('generator-controls').classList.add('hidden-mode');
                document.getElementById('practice-controls').classList.remove('hidden-mode');
                generatePracticeQuestion(); // Start a question
            }
        }

        // --- Generator Logic ---
        function findElement() {
            const inputVal = parseInt(document.getElementById('numInput').value);
            const errorDiv = document.getElementById('errorMsg');
            const tile = document.getElementById('elementTile');
            const isoSelect = document.getElementById('isotopeSelect');
            const ionSelect = document.getElementById('ionSelect');

            let found = periodicTable.find(e => e.n === inputVal);
            
            if (!found) {
                errorDiv.innerText = "Enter valid number (1-118)";
                return;
            }
            errorDiv.innerText = "";
            currentElement = found;

            // Update UI for Generator
            renderTile(currentElement, "standard", 0);

            // Populate Dropdowns
            isoSelect.innerHTML = ""; 
            const stdOption = document.createElement("option");
            stdOption.value = "standard";
            stdOption.text = "Standard Mass";
            isoSelect.add(stdOption);

            if (currentElement.iso) {
                currentElement.iso.forEach(massNum => {
                    const opt = document.createElement("option");
                    opt.value = massNum;
                    opt.text = `${currentElement.s}-${massNum}`;
                    isoSelect.add(opt);
                });
            }

            ionSelect.innerHTML = "";
            const neutralOption = document.createElement("option");
            neutralOption.value = "0";
            neutralOption.text = "Neutral";
            ionSelect.add(neutralOption);

            if (currentElement.ions) {
                currentElement.ions.forEach(charge => {
                    const opt = document.createElement("option");
                    opt.value = charge;
                    opt.text = `Ion (${formatCharge(charge)})`;
                    ionSelect.add(opt);
                });
            }
        }

        function updateTile() {
            if (!currentElement) return;
            const isoVal = document.getElementById('isotopeSelect').value;
            const ionVal = parseInt(document.getElementById('ionSelect').value);
            renderTile(currentElement, isoVal, ionVal);
        }

        // --- Practice Logic ---
        function generatePracticeQuestion() {
            // 1. Pick random element
            const randIndex = Math.floor(Math.random() * periodicTable.length);
            const el = periodicTable[randIndex];
            currentElement = el;

            // 2. Pick Isotope (use specific isotope mass or standard rounded if none)
            let massNum;
            if (el.iso && el.iso.length > 0) {
                massNum = el.iso[Math.floor(Math.random() * el.iso.length)];
            } else {
                massNum = Math.round(el.m);
            }

            // 3. Pick Ion (use specific ion or 0)
            let charge = 0;
            // 50% chance to be an ion if possible
            if (el.ions && el.ions.length > 0 && Math.random() > 0.5) {
                charge = el.ions[Math.floor(Math.random() * el.ions.length)];
            }

            // 4. Set Correct Answers
            practiceData = {
                Z: el.n,
                A: massNum,
                p: el.n,
                n: massNum - el.n,
                e: el.n - charge
            };

            // 5. Render Tile (Mass must show Integer Mass Number for calculation)
            // Passing 'massNum' as string forces the render to show that specific number
            renderTile(el, massNum.toString(), charge);

            // 6. Clear Inputs
            ['prac-z', 'prac-a', 'prac-p', 'prac-n', 'prac-e'].forEach(id => {
                const inp = document.getElementById(id);
                inp.value = "";
                inp.className = ""; // clear colors
            });
            document.getElementById('practiceMsg').innerText = "";
        }

        function checkPracticeAnswer() {
            const z = parseInt(document.getElementById('prac-z').value);
            const a = parseInt(document.getElementById('prac-a').value);
            const p = parseInt(document.getElementById('prac-p').value);
            const n = parseInt(document.getElementById('prac-n').value);
            const e = parseInt(document.getElementById('prac-e').value);

            validateInput('prac-z', z, practiceData.Z);
            validateInput('prac-a', a, practiceData.A);
            validateInput('prac-p', p, practiceData.p);
            validateInput('prac-n', n, practiceData.n);
            validateInput('prac-e', e, practiceData.e);

            if (z===practiceData.Z && a===practiceData.A && p===practiceData.p && n===practiceData.n && e===practiceData.e) {
                document.getElementById('practiceMsg').innerText = "Correct! Great job.";
                document.getElementById('practiceMsg').style.color = "var(--success)";
            } else {
                document.getElementById('practiceMsg').innerText = "Some answers are incorrect. Check the red boxes.";
                document.getElementById('practiceMsg').style.color = "var(--error)";
            }
        }

        function validateInput(id, val, correct) {
            const el = document.getElementById(id);
            if (val === correct) {
                el.classList.add('correct');
                el.classList.remove('incorrect');
            } else {
                el.classList.add('incorrect');
                el.classList.remove('correct');
            }
        }

        function showSolution() {
            document.getElementById('prac-z').value = practiceData.Z;
            document.getElementById('prac-a').value = practiceData.A;
            document.getElementById('prac-p').value = practiceData.p;
            document.getElementById('prac-n').value = practiceData.n;
            document.getElementById('prac-e').value = practiceData.e;
            checkPracticeAnswer();
        }

        // --- Shared Render ---
        function renderTile(el, isoValue, chargeValue) {
            const tile = document.getElementById('elementTile');
            const groupInfo = getElementGroup(el.n);
            
            document.getElementById('disp-number').innerText = el.n;
            document.getElementById('disp-symbol').innerText = el.s;
            document.getElementById('disp-name').innerText = el.name;
            document.getElementById('disp-group').innerText = groupInfo.g;
            tile.style.backgroundColor = groupInfo.c;

            // Mass
            const massDisplay = document.getElementById('disp-mass');
            if (isoValue === "standard") {
                massDisplay.innerText = Math.round(el.m);
            } else {
                massDisplay.innerText = isoValue; // Shows integer for Practice
            }

            // Charge
            const chargeDisplay = document.getElementById('disp-charge');
            if (chargeValue === 0) {
                chargeDisplay.innerText = ""; 
            } else {
                chargeDisplay.innerText = formatCharge(chargeValue);
            }
        }

        function downloadTile() {
            html2canvas(document.getElementById('elementTile'), {
                scale: 3, useCORS: true, backgroundColor: null 
            }).then(canvas => {
                const a = document.createElement('a');
                a.href = canvas.toDataURL("image/png");
                a.download = document.getElementById('disp-name').innerText + "-Tile.png";
                a.click();
            });
        }

        // Init
        findElement();
        document.getElementById("numInput").addEventListener("keypress", e => {
            if (e.key === "Enter") findElement();
        });
    </script>
</body>
</html>
